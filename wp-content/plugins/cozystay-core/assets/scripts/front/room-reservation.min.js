!function(d){"use strict";var l,c,u,m,f,v,h,p,g,b,R,k,_,D,C,x,y,w,P,N,S,I,M,T,r,s,E,j,A,F,L,O,q,B,Y,V,W,G,H,J,a,U,z,Q,X,K,Z,$,ee,ae,te,oe,ne,ie,re,se,le=86400,ce=!1,de=!1,ue=[],me=[],fe="YYYY-MM-DD",ve=!1,i=1,t=parseInt(2*Number.MAX_SAFE_INTEGER/3,10),he=t,pe=t,ge=t,be=!1,Re=!1,ke=-1,_e=-1,De=!1,Ce={},xe=!1;function ye(){for(var e,a,t,o=!1,n=!1,i=G;i<H;i+=le)N[i]&&"available"==N[i].status&&(a=Ie(i),e=loftoceanRoomReservation.pricePerPerson?Ae(Le(a.adult_price,V),Le(W,a.child_price)):a.price,a=N[i].special_price_rate?Le(e,N[i].special_price_rate):e,(!1===o||Number(a)<Number(o))&&(o=a),(!1===n||Number(e)<Number(n))&&(n=e));!1!==o&&(t="",t=o<n?"<del>"+Ee(n)+'</del> <span class="sale">'+Ee(o)+"</span>":Ee(o),p.html(t))}function we(){var e=void 0===g.data("min")||isNaN(g.data("min"))?1:g.data("min"),a=void 0===g.data("min")||isNaN(g.data("min"))?t:g.data("max");e<Y?R.removeClass("disabled").data("status",""):R.addClass("disabled").data("status","disabled"),Y<a?b.removeClass("disabled").data("status",""):b.addClass("disabled").data("status","disabled")}function o(){A=E.data("value"),F=j.data("value"),Se(),Ne(),function(){if(u.length){var e=!1,a=!1;clearTimeout(ve),u.removeClass("show"),g.removeData("max");for(var t=G;t<H;t+=le){if(!N[t]||"available"!=N[t].status||!N[t].available_number){a=!0;break}(!1===e||Number(N[t].available_number)<e)&&(e=Number(N[t].available_number))}!a&&!1!==e&&0<e&&(g.data("max",e),e<Y&&(u.find(".room-error-limit-number").text(e),g.val(e-1).siblings(".plus").trigger("click"),u.addClass("show"),ve=setTimeout(function(){u.removeClass("show")},3e3))),we()}}(),ye(),Te()}function Pe(){var e;de?(e={roomID:loftoceanRoomReservation.roomID,checkin:G,checkout:H,action:loftoceanRoomReservation.getFlexiblePriceRuleAjaxAction},m.html(""),f.html(""),v.addClass("loading"),d.ajax(loftoceanRoomReservation.ajaxURL,{method:"GET",data:e}).done(function(e,a){e=e?JSON.parse(e):{},ce=!(!e||!e.status||1!=e.status)&&e.discount}).fail(function(){ce=!1}).always(function(){o(),v.removeClass("loading")})):o()}function Ne(){var e=l.find(".cs-form-group.cs-extra-service-group .extra-service-switcher:checked"),r=0;e.length&&e.each(function(){var e=d(this).parent(),a="extra_service_"+d(this).val(),t=e.find('input[name="extra_service_price['+a+']"]').val();switch(e.find('input[name="extra_service_calculating_method['+a+']"]').val()){case"custom":var o=e.parent().find('input[name="extra_service_quantity['+a+']"]').val();r=Ae(r,Le(t,o));break;case"auto_custom":o=e.parent().find('input[name="extra_service_quantity['+a+']"]').val();r=Ae(r,Le(Le(t,o),(H-G)/le));break;case"auto":var n,i=e.find('input[name="extra_service_auto_calculating_unit['+a+']"]').val();["night-room"].includes(i)&&(t=Le(t,parseInt(Y,10))),["person","night-person"].includes(i)&&(n=e.find('input[name="extra_service_auto_calculating_custom_adult_price['+a+']"]'),o=e.find('input[name="extra_service_auto_calculating_custom_child_price['+a+']"]'),t=n.length&&o.length?(n=n.val()?n.val():0,o=o.val()?o.val():0,Ae(Le(n,parseInt(V,10)),Le(o,parseInt(W,10)))):Le(t,parseInt(V,10)+parseInt(W,10))),["night","night-person","night-room"].includes(i)&&(t=Le(t,(H-G)/le)),r=Ae(r,t);break;default:r=Ae(r,t)}}),S=r}function Se(){var e=new Date(A),a=new Date(F),t=Me(e),o=Me(a),n=0,i=0,r=0;if(void 0===N[o-le])e.setDate(e.getDate()-15),a.setDate(a.getDate()+15),e=je(e),a=je(a),w&&e&&a&&d.ajax({url:wpApiSettings.root+"loftocean/v1/get_room_availability/"+(new Date).getTime(),data:{rid:w,start:e,end:a},type:"POST",success:function(e,a){"object"==typeof e&&(e.forEach(function(e){N[e.id]=e}),Se(),Ne(),Te())},error:function(e){console.log(P.getRemotePriceListErrorMessage)}});else{for(var s,l,c=t;c<o;c+=le)N[c]&&"available"==N[c].status&&(s=N[c].special_price_rate||1,n=Ae(n,Le((l=Ie(c)).price,s)),i=Ae(i,Le(l.adult_price,s)),r=Ae(r,Le(l.child_price,s)));I=n,M=i,T=r}}function Ie(n){var e,i={price:N[n].price,adult_price:N[n].adult_price,child_price:N[n].child_price};return De&&(e=Je(V)+Je(W),(xe?["adult"+V+"-child"+W,"adult"+V+"-child","adult-child"+W,"adult-child"]:["guests"+e,"guests"]).every(function(e){if(Ce.hasOwnProperty(e)){var a,t,o=Ce[e];return"per_person"==loftoceanRoomReservation.variablePrices.mode?xe?["adult_price","child_price"].forEach(function(e){var a="weekend_"+e;"yes"==N[n].is_weekend&&!isNaN(o[a])&&-1<o[a]?i[e]=o[a]:!isNaN(o[e])&&-1<o[e]&&(i[e]=o[e])}):(a="price",t="weekend_price","yes"==N[n].is_weekend&&!isNaN(o[t])&&-1<o[t]?(i.adult_price=o[t],i.child_price=o[t]):!isNaN(o[a])&&-1<o[a]&&(i.adult_price=o[a],i.child_price=o[a])):(a="price",t="weekend_price","yes"==N[n].is_weekend&&!isNaN(o[t])&&-1<o[t]?i.price=o[t]:!isNaN(o[a])&&-1<o[a]&&(i.price=o[a])),!1}return!0})),i}function Me(e){return void 0===e||e.getTime||(e=new Date),Math.floor(e.getTime()/le/1e3)*le}function Te(){var e=loftoceanRoomReservation.pricePerPerson?Ae(Le(M,V),Le(T,W)):Le(I,Y);!1!==ce&&ce.totleDiscount?e=Le(r=e,ce.totleDiscount):r=e,s=e,function(){var e=[],a=Ae(s,S),t={totalBasePrice:Ee(r,!0),nights:(H-G)/le,totalPrice:Ee(a,!0),totalOriginalPrice:a};S&&(t.extraService=Ee(S,!0)),!1!==ce&&ce.discount.base_percentage&&Object.keys(ce.discount.details).forEach(function(e){var a=ce.discount.details[e];t[e]="-"+Ee(Le(r,a.discount))});for(var o,n,i=G;i<H;i+=le)N[i]&&("available"==N[i].status?(o=N[i].special_price_rate||1,n=Ie(i),n=loftoceanRoomReservation.pricePerPerson?Ae(Le(n.adult_price,V),Le(n.child_price,W)):Le(n.price,Y),e.push({date:moment(N[i].start).format(Q),originalPrice:Ee(n,!0),price:Ee(Le(n,o),!0)})):e.push({date:moment(N[i].start).format(Q),price:!1}));t.rooms=e,Ve(a,t),h.html("").append(J(t)),c.html(t.totalPrice)}()}function Ee(e,a){var t,o=0,n=0,i="";e=void 0===e?0:(t=e,!isNaN(t)&&isFinite(t)?e:0);try{o=(""+e).split(".")[1].length}catch(e){o=0}if(e=Number(e).toFixed(o?Math.max(0,loftoceanRoomReservation.currencySettings.precision):0),e=(""+e).split("."),i=Number(e[0]),loftoceanRoomReservation.currencySettings.thousandSeparator&&1e3<(n=Number(e[0]))){for(i=(n+"").substr(-3),n=Math.floor(n/1e3);1e3<n;)i=(n+"").substr(-3)+loftoceanRoomReservation.currencySettings.thousandSeparator+i,n=Math.floor(n/1e3);0<n&&(i=n+loftoceanRoomReservation.currencySettings.thousandSeparator+i)}return 1<e.length&&0<Number(e[1])&&loftoceanRoomReservation.currencySettings.precision&&loftoceanRoomReservation.currencySettings.decimalSeparator&&(i+=loftoceanRoomReservation.currencySettings.decimalSeparator+e[1]),a?i:loftoceanRoomReservation.currency.left+i+loftoceanRoomReservation.currency.right}function n(e){return 9<e?e:"0"+e}function je(e){return"Invalid Date"===e.toString()?"":e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())}function Ae(e,a){var t,o,n;try{t=(""+e).split(".")[1].length}catch(e){t=0}try{o=(""+a).split(".")[1].length}catch(e){o=0}return n=Math.max(t,o),((e*Math.pow(10,n)+a*Math.pow(10,n))/Math.pow(10,n)).toFixed(n)}function Fe(e,a){return Ae(e,-a)}function Le(e,a){var t,o;try{t=(""+e).split(".")[1].length}catch(e){t=0}try{o=(""+a).split(".")[1].length}catch(e){o=0}return(e*Math.pow(10,t)*(a*Math.pow(10,o))/Math.pow(10,t+o)).toFixed(t+o)}function Oe(e,a){if(e=e.format(fe),void 0!==a&&null!==a.startDate&&null===a.endDate||!ue.includes(e)){var t=void 0!==a&&null!==a.startDate&&null===a.endDate;if(t){if(moment(e).isBefore(a.startDate))return[!1,"",""];if(me.length){if(me.includes(e))return[!1,"",""];var o=a.startDate.clone(),n=moment(e);for(o.add("1","day");o.isBefore(n);){if(ue.includes(o.format(fe)))return[!1,"",""];o.add("1","day")}}}var e=new Date(e),i="day"+e.getDay(),r=Me(e),s=[],l=[];if(loftoceanRoomReservation.unavailableDates){if(loftoceanRoomReservation.unavailableDates.in_advance&&loftoceanRoomReservation.unavailableDates.in_advance.length)for(let e=0;e<loftoceanRoomReservation.unavailableDates.in_advance.length;e++){var c=loftoceanRoomReservation.unavailableDates.in_advance[e];if("all"==c.id||c.start<=r&&r<=c.end){c.min&&(r-z)/le<c.min&&s.push("disabled","checkin-unavailable"),c.max&&(r-z)/le>c.max&&(s.push("checkin-unavailable"),void 0!==a&&null!==a.startDate&&null===a.endDate||s.push(" disabled"));break}}if(loftoceanRoomReservation.unavailableDates.checkin&&loftoceanRoomReservation.unavailableDates.checkin.length)for(let a=0;a<loftoceanRoomReservation.unavailableDates.checkin.length;a++){let e=loftoceanRoomReservation.unavailableDates.checkin[a];if("all"==e.id||e.start<=r&&r<=e.end){e.days.includes(i)&&(s.push("no-checkin","checkin-unavailable"),l.push(P.noCheckin));break}}if(loftoceanRoomReservation.unavailableDates.checkout&&loftoceanRoomReservation.unavailableDates.checkout.length)for(let a=0;a<loftoceanRoomReservation.unavailableDates.checkout.length;a++){let e=loftoceanRoomReservation.unavailableDates.checkout[a];if("all"==e.id||e.end>=r&&r>=e.start){e.days.includes(i)&&(s.push("no-checkout","checkout-unavailable"),l.push(P.noCheckout));break}}if(t&&loftoceanRoomReservation.unavailableDates.stay_length&&loftoceanRoomReservation.unavailableDates.stay_length.length){var d=Me(new Date(a.startDate.format(fe))),u="day"+a.startDate.day();if(d<r)for(let e=0;e<loftoceanRoomReservation.unavailableDates.stay_length.length;e++){var m=loftoceanRoomReservation.unavailableDates.stay_length[e];if("all"==m.id||m.end>=d&&d>=m.start){var f=(r-d)/le;m.rules[u]&&(m.rules[u].min&&f<m.rules[u].min&&(s.push("minimal-stay-unavailable","checkout-unavailable"),l.push(m.rules[u].min+P.minimum)),m.rules[u].max&&f>m.rules[u].max&&(s.push("off","disabled","maximal-stay-unavailable","checkout-unavailable"),l.push(m.rules[u].max+P.maximum)));break}}}}return[!0,s.length?s.join(" "):"",l.length?l.join(", "):""]}return[!1,"",""]}function qe(e,a){E.val(moment(e).format(Q)).data("value",e),j.val(moment(a).format(Q)).data("value",a),L&&(q.text(moment(e).format(Q)),B.text(moment(a).format(Q)).css("opacity","")),A=e,G=Me(new Date(e)),F=a,H=Me(new Date(a)),Ye(G,H),Pe()}function Be(e,a){for(var t=0,o=0,n=e.clone(),i=null;t++<70;){var r=Oe(n);if(!r[0]||r[1]&&r[1].split(" ").includes("checkin-unavailable"))n.add("1","day");else{o=0,i=n.clone().add("1","day");for(var s={startDate:n,endDate:null};o++<70;){var l=Oe(i,s);if(!(!l[0]||l[1]&&l[1].split(" ").includes("checkout-unavailable")))return{checkin:n.format(fe),checkout:i.format(fe)};i.add("1","day")}n.add("1","day")}}return{checkin:e.format(fe),checkout:a.format(fe)}}function Ye(i,r){var s,e;X&&K&&(K=!(s=[]),loftoceanRoomReservation.extraServices.forEach(function(a){if(""!==a.effective_time&&a.custom_effective_time_slots.length){var t=K=!0,o="activated"==a.effective_time;for(let e=0;e<a.custom_effective_time_slots.length;e++){var n=a.custom_effective_time_slots[e];if((!n.start_timestamp||n.start_timestamp<=i)&&(!n.end_timstamp||n.end_timstamp>=r)){o?s.push(d.extend({},a)):t=!1;break}}!o&&t&&s.push(d.extend({},a))}else s.push(d.extend({},a))}),(e=d("#secondary .cs-form-group.cs-extra-service-group")).length&&e.remove(),s.length&&Z.before(a({currency:loftoceanRoomReservation.currency,services:s})))}function Ve(e,a){var t;loftoceanRoomReservation.isTaxEnabled&&(loftoceanRoomReservation.taxIncluded?(t=function(e){var a=Ae(loftoceanRoomReservation.currencySettings.precision,2),t=loftoceanRoomReservation.taxRate,o=[],n=e,i=0;if(t.reversed_compound_rates&&t.reversed_compound_rates.length)for(var r=0;r<t.reversed_compound_rates.length;r++)n=Le(i=n,100/(100+t.reversed_compound_rates[r].rate)),n=Number(n).toFixed(a),o.unshift({tax:Ee(Fe(i,n)),label:t.reversed_compound_rates[r].label});if(t.regular_rates&&t.regular_rates.length){for(var s=100,r=0;r<t.regular_rates.length;r++)s=Ae(s,t.regular_rates[r].rate);for(n=Le(n,100/s),n=Number(n).toFixed(a),--r;0<=r;r--)o.push({tax:Ee(Le(n,t.regular_rates[r].rate/100)),label:t.regular_rates[r].label})}return{totalTax:Fe(e,n),taxDetails:o}}(e),a.tax=Ee(t.totalTax),a.taxDetails=t.taxDetails):(t=function(e){var a=loftoceanRoomReservation.taxRate,t=e,o=0,n=[];if(a.regular_rates&&a.regular_rates.length){for(var i=0,r=0;r<a.regular_rates.length;r++)i=Le(e,a.regular_rates[r].rate/100),n.push({tax:Ee(i),label:a.regular_rates[r].label}),o=Ae(o,i);t=Ae(e,o)}if(a.compound_rates&&a.compound_rates.length)for(var s=0,r=0;r<a.compound_rates.length;r++)s=Le(t,a.compound_rates[r].rate/100),o=Ae(o,s),t=Ae(t,s),n.push({tax:Ee(s),label:a.compound_rates[r].label});return{totalTax:o,taxDetails:n}}(e),a.tax=Ee(t.totalTax),a.taxDetails=t.taxDetails,a.beforeTax=a.totalPrice,a.totalPrice=Ee(Ae(a.totalOriginalPrice,t.totalTax),!0)))}function We(){ae&&(re?function(){var e=W,a=!1;te&&e<(i=ne*Y)&&(e=i,a=!0);oe&&(he=ie*Y)<e&&(e=he,a=!0);Re&&(ge=_e*Y)<e&&(e=ge,a=!0);a&&C.val(e-1).siblings(".plus").trigger("click",!0)}:se?function(){var e=V,a=!1;te&&e<(i=ne*Y)&&(e=i,a=!0);oe&&(he=ie*Y)<e&&(e=he,a=!0);Re&&(pe=_e*Y)<e&&(e=pe,a=!0);a&&k.val(e-1).siblings(".plus").trigger("click",!0)}:function(){var e=V,a=W,t=!1,o=!1,n=e+a;pe=be?ke*Y:pe,ge=Re?_e*Y:ge,!te||n<(i=ne*Y)&&(e-=n-i,n=parseInt(e,10)+parseInt(a,10),t=!0);oe&&(he=ie*Y)<n&&(o=!0,(a-=n-he)<0&&(e+=a,o=!["0",a=0].includes(W),e=Math.max(1,e),t=!0));be&&pe<e&&(a-=pe-e,e=pe,o=t=!0);Re&&ge<a&&(a=ge,o=!0);t&&(W=a,V=e-1,k.val(V).siblings(".plus").trigger("click",!0));o&&(1<a?(W=a-1,C.val(W).siblings(".plus").trigger("click",!0)):(W=a+1,C.val(W).siblings(".minus").removeClass("disabled").removeAttr("disabled").trigger("click",!0)))})()}function Ge(e){if(!ee)return!0;var a=void 0===e||!e,t=a?0:1,o=a?pe:ge,n=a?W:V,e=a?V:W;return!(parseInt(V,10)+parseInt(W,10)===i&&t<n&&e<o)||(a?(C.siblings(".minus").trigger("click",!0),k.siblings(".plus").trigger("click",!0)):(k.siblings(".minus").trigger("click",!0),C.siblings(".plus").trigger("click",!0)),!1)}function He(e,a){var t=parseInt(V,10)+parseInt(W,10);return a?t<he&&function(e){if(be&&"adult"==e)return parseInt(V,10)<pe;if(Re&&"child"==e)return parseInt(W,10)<ge;return!0}(e):i<t}function Je(e){return isNaN(e)?0:parseInt(e,10)}function Ue(){var t,e=parseInt(V,10),a=parseInt(W,10),o=parseInt(V,10)+parseInt(W,10);o<he?(be&&pe<=e?_.addClass("disabled").data("status","disabled").children().first().attr("data-title",P.adult.plus.general.replace("[number]",pe)).removeClass("hide"):_.removeClass("disabled").data("status","").children().addClass("hide"),Re&&ge<=a?x.addClass("disabled").data("status","disabled").children().first().attr("data-title",P.child.plus.general.replace("[number]",ge)).removeClass("hide"):x.removeClass("disabled").data("status","").children().addClass("hide")):(_.addClass("disabled").data("status","disabled").children().first().attr("data-title",P.adult.plus.maximum.replace("[number]",he)).removeClass("hide"),x.addClass("disabled").data("status","disabled").children().first().attr("data-title",P.child.plus.maximum.replace("[number]",he)).removeClass("hide")),D.removeClass("cs-hint"),y.removeClass("cs-hint"),i<o?(e=re?1:0,((a=re?0:1)<V?D.removeClass("disabled").data("status","").children():D.addClass("disabled").data("status","disabled").children().first().attr("data-title",P.adult.minus.general.replace("[number]",a))).addClass("hide"),(e<W?y.removeClass("disabled").data("status","").children():y.addClass("disabled").data("status","disabled").children().first().attr("data-title",P.child.minus.general.replace("[number]",e))).addClass("hide")):(D.addClass("disabled").data("status","disabled"),V<2?D.children().first().addClass("hide"):D.children().first().attr("data-title",P.adult.minus.minimum.replace("[number]",i)).removeClass("hide"),y.addClass("disabled").data("status","disabled"),W<(re?2:1)?y.children().first().addClass("hide"):y.children().first().attr("data-title",P.child.minus.minimum.replace("[number]",i)).removeClass("hide"),o===i&&ee&&(t={child:y,adult:D},["child","adult"].forEach(function(e){var a="child"==e;(a?0:1)<(a?W:V)&&(a?V:W)<(a?pe:ge)&&t[e].removeClass("disabled").data("status","").addClass("cs-hint").children().first().attr("data-title",P[e].minus.minimum.replace("[number]",i)).removeClass("hide")})))}document.addEventListener("DOMContentLoaded",function(){if("undefined"==loftoceanRoomReservation)return!1;var i,r,t;d("body"),l=d("#secondary .cs-reservation-form"),Q=loftoceanRoomReservation.displayDateFormat,ee=!!l.data("guests-field"),J=wp.template("loftocean-room-price-details"),a=wp.template("loftocean-room-extra-services"),X=loftoceanRoomReservation.extraServices&&loftoceanRoomReservation.extraServices.length,K=!0,p=d("#secondary .base-price"),v=d("#secondary .cs-room-booking"),h=d("#secondary .cs-form-price-details"),Z=l.find(".cs-form-total-price"),c=Z.find(".total-price-number"),N=loftoceanRoomReservation.priceList,w=loftoceanRoomReservation.roomID,P=loftoceanRoomReservation.i18nText,de=!!loftoceanRoomReservation.hasFlexibilePriceRules,E=l.find(".cs-check-in input[name=checkin]"),j=l.find(".cs-check-out input[name=checkout]"),g=l.find(".cs-rooms input[name=room-quantity]"),b=g.siblings(".plus"),R=g.siblings(".minus"),k=l.find(".cs-adults input[name=adult-quantity]"),_=k.siblings(".plus"),D=k.siblings(".minus"),C=l.find(".cs-children input[name=child-quantity]"),x=C.siblings(".plus"),y=C.siblings(".minus"),i=E.closest(".cs-form-field.cs-check-in"),r=j.closest(".cs-form-field.cs-check-out"),t=r.length?r.outerHeight(!0):0,u=l.find(".cs-form-field.cs-rooms > .cs-form-notice"),m=l.children(".cs-form-error-message"),f=l.children(".cs-form-success-message"),U=d(".room-availability-calendar-wrapper .hidden-calendar"),$=U.length,ne=parseInt(loftoceanRoomReservation.guestLimitation.min,10),ie=parseInt(loftoceanRoomReservation.guestLimitation.max,10),te=!isNaN(ne)&&0<ne,oe=!isNaN(ie)&&0<ie,re=!ee&&!l.find(".cs-form-field.cs-children").hasClass("hide"),se=!ee&&!l.find(".cs-form-field.cs-adults").hasClass("hide"),ke=parseInt(loftoceanRoomReservation.guestLimitation.maxAdult,10),_e=parseInt(loftoceanRoomReservation.guestLimitation.maxChild,10),be=!isNaN(ke)&&0<ke,Re=!isNaN(_e)&&0<_e,ae=te||oe||Re||be,z=Me(""),d.each(loftoceanRoomReservation.priceList,function(e,a){("unavailable"==a.status||a.available_number<1)&&(ue.push(a.start),me.push(a.end))});var e=function(){if(loftoceanRoomReservation.passParamsFromSearchResultPage){var e=loftoceanRoomReservation.searchResultParams.checkin,a=loftoceanRoomReservation.searchResultParams.checkout,t=moment(e),o=moment(a),n=Oe(t);if(n[0]&&(!n[1]||!n[1].split(" ").includes("checkin-unavailable"))){t=Oe(o,{startDate:t,endDate:null});if(t[0]&&(!t[1]||!t[1].split(" ").includes("checkout-unavailable")))return{checkin:e,checkout:a}}}return Be(moment(),moment().add("1","day"))}(),o=e.checkin,n=e.checkout;E.val(moment(o).format(Q)).data("value",o),j.val(moment(n).format(Q)).data("value",n),A=o,G=Me(new Date(A)),F=n,H=Me(new Date(F)),V=Je(k.val()),W=Je(C.val()),Y=Je(g.val()),S=T=M=I=0,O=l.find(".cs-form-field-group.date-group"),(L=O.length)&&(q=E.siblings("span.input"),B=j.siblings("span.input"),q.text(moment(o).format(Q)),B.text(moment(n).format(Q))),loftoceanRoomReservation.variablePrices.enable&&"[object Object]"==Object.prototype.toString.call(loftoceanRoomReservation.variablePrices.prices)&&(loftoceanRoomReservation.pricePerPerson&&"per_person"==loftoceanRoomReservation.variablePrices.mode||!loftoceanRoomReservation.pricePerPerson&&"per_person"!=loftoceanRoomReservation.variablePrices.mode)&&(De=!0,xe=void 0!==loftoceanRoomReservation.variablePrices.guestMode&&"group"==loftoceanRoomReservation.variablePrices.guestMode,void 0!==loftoceanRoomReservation.variablePrices.enableWeekendPrice&&loftoceanRoomReservation.variablePrices.enableWeekendPrice,Ce=loftoceanRoomReservation.variablePrices.prices);var s=l.find(".date-range-picker");$&&U.daterangepicker({parentEl:".room-availability-calendar-wrapper",minDate:moment().format(fe),maxDate:moment().add(loftoceanRoomReservation.maximalMonthsAllowedForBooking,"M").format(fe),startDate:o,endDate:n,alwaysShowCalendars:!0,buttonClasses:l.length?"btn btn-sm":"btn btn-sm hide",disableButtons:!l.length,locale:{format:fe,applyLabel:loftoceanRoomReservation.availabilityCalendarText.apply,cancelLabel:loftoceanRoomReservation.availabilityCalendarText.cancel},beforeShowDay:Oe}).trigger("click").on("apply.daterangepicker",function(e,a){a.show();var t=a.startDate.format(fe),a=a.endDate.format(fe);l.length&&(s.val(t+" - "+a),qe(t,a),d("html, body").animate({scrollTop:E.offset().top-window.innerHeight/2},200))}).on("cancel.daterangepicker",function(e,a){a.show(),a.setStartDate(o),a.setEndDate(n),a.updateView()}).on("outsideClick.daterangepicker",function(e,a){a.show()}),l.length&&(d("#content.site-content.with-sidebar-right").length&&s.addClass("pull-right"),s.daterangepicker({minDate:moment().format(fe),maxDate:moment().add(loftoceanRoomReservation.maximalMonthsAllowedForBooking,"M").format(fe),startDate:o,endDate:n,locale:{format:fe},autoApply:!0,beforeShowDay:Oe}).on("apply.daterangepicker",function(e,a){var t,o=a.startDate.format(fe),n=a.endDate.format(fe);d(this).val(o+" - "+n),qe(o,n),$&&((t=U.data("daterangepicker")).setStartDate(o),t.setEndDate(n),t.updateView()),L?O.removeClass("loftocean-highlighted"):(i.removeClass("loftocean-highlighted"),r.removeClass("loftocean-highlighted"),a.container.css({transform:"",transition:""}))}).on("show.daterangepicker",function(e,a){a.popupSingle=!1,a.container.removeClass("single").find(".drp-calendar.right").show(),a.container.outerWidth(!0)<558?(a.popupSingle=!0,a.container.addClass("single").find(".drp-calendar.right").hide()):(a.popupSingle=!1,a.container.removeClass("single").find(".drp-calendar.right").show()),a.renderCalendar("left"),L?O.addClass("loftocean-highlighted"):(i.addClass("loftocean-highlighted"),r.removeClass("loftocean-highlighted"))}).on("setStartDate.daterangepicker",function(e,a){L?(q.text(a.startDate.format(Q)),B.css("opacity",0)):(E.val(a.startDate.format(Q)),j.val(""),i.removeClass("loftocean-highlighted"),r.addClass("loftocean-highlighted"),a.container.css({transform:"translateY("+t+"px)",transition:"0.15s"}))}).on("outsideClick.daterangepicker",function(e,a){a.oldStartDate&&(L?(q.text(a.oldStartDate.format(Q)),B.text(a.oldEndDate.format(Q)).css("opacity","")):(E.val(a.oldStartDate.format(Q)),j.val(a.oldEndDate.format(Q)))),L?O.removeClass("loftocean-highlighted"):(i.removeClass("loftocean-highlighted"),r.removeClass("loftocean-highlighted"),a.container.css({transform:"",transition:""}))}),l.find(".field-input-wrap.checkin-date, .field-input-wrap.checkout-date, .cs-form-field-group.date-group .cs-form-field-group-inner").on("click",function(e){var a=s.data("daterangepicker"),t=moment(E.data("value")?E.data("value"):""),o=moment(j.data("value")?j.data("value"):""),t=t.isValid()?t:moment(),o=o.isAfter(t)?o:t.clone().add("1","day"),t=function(e,a){var t=Oe(e);if(t[0]&&(!t[1]||!t[1].split(" ").includes("checkin-unavailable"))){t=Oe(a,{startDate:e,endDate:null});if(t[0]&&(!t[1]||!t[1].split(" ").includes("checkout-unavailable")))return{checkin:e.format(fe),checkout:a.format(fe)}}return Be(e,a)}(t,o),o=t.checkin,t=t.checkout;a.setStartDate(o),a.setEndDate(t),a.show()})),h.length&&(Z.on("click",function(e){var a=d(this);h.hasClass("hide")?(a.addClass("toggled-on"),h.removeClass("hide")):(a.removeClass("toggled-on"),h.addClass("hide"))}),Z.hasClass("default-hide")||Z.trigger("click"),Z.hasClass("always-show")&&Z.off("click")),l.on("change",".cs-form-group.cs-extra-service-group .label-checkbox .extra-service-switcher",function(){Ne(),Te()}).on("click",".cs-form-group.cs-extra-service-group .extra-service-custom-quantity button",function(e){setTimeout(function(){Ne(),Te()},50)}),g.on("loftocean.number.changed",function(e,a,t){t.data("status")&&"disabled"==t.data("status")||(Y=Je(g.val()),We(),Te(),we(),Ue())}).parent().on("click","button",function(e){u.removeClass("show"),clearTimeout(ve)}),k.on("loftocean.number.changed",function(e,a,t){e.preventDefault(),t.data("status")&&"disabled"==t.data("status")||(V=Je(k.val()),Se(),Ne(),Te(),(loftoceanRoomReservation.pricePerPerson||De)&&ye(),Ue())}).parent().on("click","button",function(e,a){if(void 0===a){var t=d(this).hasClass("plus"),o=He("adult",t);if(!(!!t||Ge(!0))||!o)return e.preventDefault(),e.stopImmediatePropagation(),!1}else a&&(_.removeClass("disabled").data("status",""),D.removeClass("disabled").data("status",""),x.removeClass("disabled").data("status",""),y.removeClass("disabled").data("status",""))}),C.on("loftocean.number.changed",function(e,a,t){e.preventDefault(),t.data("status")&&"disabled"==t.data("status")||(W=Je(C.val()),Se(),Ne(),Te(),(loftoceanRoomReservation.pricePerPerson||De)&&ye(),Ue())}).parent().on("click","button",function(e,a){if(void 0===a){var t=d(this).hasClass("plus"),o=He("child",t);if(!(!!t||Ge(!1))||!o)return e.preventDefault(),e.stopImmediatePropagation(),!1}else a&&(_.removeClass("disabled").data("status",""),D.removeClass("disabled").data("status",""),x.removeClass("disabled").data("status",""),y.removeClass("disabled").data("status",""))}),d("body").on("click",function(e){var a=d(e.target),e=d(".csf-base-price-breakdown");!e.length||a.hasClass("csf-base-price-breakdown")||a.parents(".csf-base-price-breakdown").length||e.parent().hasClass("always-show")||d(".csf-base-price-breakdown").removeClass("show")}).on("mouseenter",".daterangepicker-has-tooltip",function(){var e=d(this).find(".day-tooltip");e.length&&e.removeClass("hide")}).on("mouseleave",".daterangepicker-has-tooltip",function(){var e=d(this).find(".day-tooltip");e.length&&e.addClass("hide")}),l.on("click",".csf-pd-total-base .csf-pd-label",function(e){e.stopImmediatePropagation(),e.stopPropagation(),d(this).parent().hasClass("always-show")||((e=d(this).siblings(".csf-base-price-breakdown")).hasClass("show")||e.addClass("show"))}).on("click",".cs-submit button",function(e){e.preventDefault();var a={roomID:loftoceanRoomReservation.roomID,action:loftoceanRoomReservation.addRoomToCartAjaxAction};return l.find("input,select,cheeckbox").serializeArray().forEach(function(e){a[e.name]=e.value}),a.checkin=E.data("value"),a.checkout=j.data("value"),m.html(""),f.html(""),v.addClass("loading"),d.ajax(loftoceanRoomReservation.ajaxURL,{method:"POST",data:a}).done(function(e,a){var t=!1;"success"==a&&"object"==typeof(e=e?JSON.parse(e):{})&&(e.message?(t=!0,m.html("<p>"+e.message+"</p>")):e.redirect&&(t=!0,f.html("<p>"+P.bookingSuccess+"</p>"),setTimeout(function(){window.location.href=loftoceanRoomReservation.cartPage},500))),t||m.html("<p>"+P.bookingError+"</p>")}).fail(function(){m.html("<p>"+P.bookingError+"</p>")}).always(function(){v.removeClass("loading")}),!1}),l.length&&(re?(k.data("min",0).val(1).siblings(".minus").trigger("click",!0),C.data("min",1).val(0).siblings(".plus").trigger("click",!0)):Ue(),We(),Ye(G,H),Pe(),v.removeClass("loading"))})}(jQuery);