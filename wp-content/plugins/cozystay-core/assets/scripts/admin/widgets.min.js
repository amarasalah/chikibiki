!function(p){"use strict";function e(e,t){var i,n,a=t.find("> .widget-inside > .form, > .widget-inside > form"),d=a.find("> .id_base").val();-1!==c.indexOf(d)&&(i=a.find(".widget-id").val(),-1===l.indexOf(i)&&(n=function(){t.hasClass("open")?(l.push(i),o(t,d,!1)):setTimeout(n,50)})())}function o(i,e,t){var n,a,d=i.find("input.loftocean-color-picker"),o=i.find(".editor-widget-control.item-type-editor"),r=i.find(".item-wrapper.item-type-image"),s=i.find("input[type=number]"),c=i.find(".sortable-selection-value"),l=i.find(".slider-widget-control");s.length&&s.on("change",function(e){var t=parseInt(p(this).val(),10),i=p(this).attr("min"),n=p(this).attr("max");i&&t<parseInt(i,10)&&p(this).val(i),n&&t>parseInt(n,10)&&p(this).val(n)}),r.length&&r.each(function(){p(this).on("click",".button.widget-choose-media, .media-widget-preview",function(e){e.preventDefault();var t=p(this),i=t.hasClass("media")?"media":"image";"media"==i&&t.hasClass("media-widget-preview")&&t.children("video").length?(e=t.children("video").get(0)).paused?e.play():e.pause():(t=(t.hasClass("media-widget-preview")?t:t.parent()).siblings("input[type=hidden]"),loftoceanMedia.open(t.first(),i))}).on("click",".button.widget-remove-media",function(e){e.preventDefault();var t=p(this),i=t.parent(),e=i.siblings(".media-widget-preview");t.removeClass("not-selected").addClass("selected"),i.siblings("input[type=hidden]").val("").first().trigger("change"),e.html("").append(p("<div>",{class:"placeholder",text:e.attr("data-text-preview")}))}).on("changed.loftocean.media","input.loftocean-widget-item[type=hidden]",function(e,t){var i,n,a,d,o;e.preventDefault(),t&&-1!==["image","video"].indexOf(t.type)&&(i=t.type,o=t.sizes&&(t.sizes.medium||t.sizes.thumbnail)||t,n="image"==i?p("<img>",{class:"attachment-thumb",src:o.url,width:o.width||0,height:o.height||0}):p("<video>",{class:"attachment-thumb",src:o.url}),d=(a=p(this)).siblings(".media-widget-preview"),e=a.siblings(".media-widget-buttons"),o=a.siblings("input[type=hidden]"),d.html("").append(n),e.children(".button.widget-remove-media").removeClass("selected").addClass("not-selected"),o.length&&o.val(i),a.val(t.id).trigger("change"))})}),d.length&&d.each(function(){var i=p(this);i.wpColorPicker({change:function(e,t){t=t.color?t.color.toString():"";i.val(t).trigger("change")},clear:function(){i.val(""),p(this).trigger("change")}})}),o.length&&!t&&o.each(function(){var r,s,c,l,e,u,g,f;r=p(this).find(".editor-textarea-wrap textarea").data("id"),s=p(this),f=!(g=1e3),c=(u=s).find(".editor-textarea-wrap textarea"),e=c.val(),l=function(){u.editor.isDirty()&&(wp.customize&&wp.customize.state&&(wp.customize.state("processing").set(wp.customize.state("processing").get()+1),_.delay(function(){wp.customize.state("processing").set(wp.customize.state("processing").get()-1)},300)),c.val(wp.editor.getContent(r))),f&&e!==c.val()&&(c.trigger("change"),f=!1,e=c.val())},function e(){var t,i,n,a="loftocean-widget-editor-id",d=tinyMCEPreInit&&tinyMCEPreInit.mceInit&&a in tinyMCEPreInit.mceInit&&window.tinymce,o=tinyMCEPreInit&&tinyMCEPreInit.qtInit&&a in tinyMCEPreInit.qtInit&&quicktags;d&&o&&c.length&&(tinymce.get(r)&&(o=window.tinymce.get(r),i=window.QTags.getInstance(r),n=s.find("#wp-"+r+"-wrap"),c.val(wp.editor.getContent(r)),o&&o.remove(),i&&i.remove(),n.length&&n.remove()),h=h||p.extend({},{mce:tinyMCEPreInit.mceInit[a],qt:tinyMCEPreInit.qtInit[a]}),i=p.extend({},h.mce,{selector:"#"+r,body_class:h.mce.body_class.replace(a,r)}),n=p.extend({},h.qt,{id:r}),a=p("#tmpl-loftocean-widget-editor-field").html(),(a=p(a.replace(/\[\[loftocean-widget-editor-id\]\]/g,r))).find("textarea").attr("id",r).val(c.val()),s.append(a),window.tinymce.init(i),quicktags(n),(t=window.tinymce.get(r))&&(n=function(){p(t.getWin()).on("unload",function(){_.defer(e)})},t.initialized?n():t.on("init",n),u.editorFocused=!1,a.find("textarea").on("keyup change blur",function(){f=!0,t.setDirty(!0),l()}),t.on("focus",function(){u.editorFocused=!0}),t.on("paste",function(){t.setDirty(!0),l()}),t.on("NodeChange",function(){f=!0}),t.on("NodeChange",_.debounce(l,g)),t.on("blur hide",function(){u.editorFocused=!1,l()}),u.editor=t))}()}),l.length&&l.each(function(){var e=p(this).find(".loader-ui-slider"),i=p(this).find("input").first();e.slider({range:"min",min:e.data("min"),max:e.data("max"),value:e.data("value"),step:e.data("step"),slide:function(e,t){i.val(t.value).trigger("change")}})}),c.length&&c.each(function(){var n=p(this),a=n.siblings(".sortable-selection-list"),d=n.siblings(".sortable"),e=n.val();e&&(e=e.split(","),Array.isArray(e)&&p.each(e,function(e,t){var i=a.find("[value="+t+"]");i.length&&(i.hide(),d.append(p("<li>",{"data-id":t}).append(p("<span>",{class:"label"}).append(i.html())).append(p("<a>",{text:"x",class:"action-remove",href:"#"}))))})),d.on("value.update",function(){var e=[];p(this).children().each(function(){p(this).attr("data-id")&&e.push(p(this).attr("data-id"))}),n.val(e.join(",")).trigger("change")}).sortable({stop:function(e,t){p(this).trigger("value.update")}}),d.on("click","a",function(e){e.preventDefault();e=p(this).parent();a.find("[value="+e.attr("data-id")+"]").show(),e.remove(),d.sortable("refresh"),d.trigger("value.update")}),a.children().on("click",function(e){e.preventDefault();var t=p(this),i=t.attr("value"),e=n.val();d.append(p("<li>",{"data-id":i}).append(p("<span>",{class:"label"}).append(t.html())).append(p("<a>",{text:"x",class:"action-remove",href:"#"}))),t.hide(),d.sortable("refresh"),n.val(e?e+","+i:i)})}),e in g&&e in f&&(n=g[e],a=f[e],i.find(".loftocean-widget-item").on("change",function(){var e=p(this).data("loftocean-widget-item-id");e in n&&u(i,n[e],a)}),p.each(n,function(e,t){u(i,t,a)}))}function d(e){var t=typeof e;return"function"==t||"object"==t&&e}function r(e,t){if(d(e)){var i="AND";return e.relation&&(i=e.relation?e.relation.toUpperCase():"AND"),("AND"==i?function(e,i,n){if(!d(e))return!0;var a=!0;return p.each(e,function(e,t){if(d(t)&&!(i?r(t,n):s(e,t,n)))return a=!1}),a}:function(e,i,n){if(!d(e))return!0;var a=!1;return p.each(e,function(e,t){if(d(t)&&(i?r(t,n):s(e,t,n)))return!(a=!0)}),a})(e,e.is_complex||!1,t)}return!0}function s(e,t,i){if(!e||!t||!t.value)return!1;var n=t.operator||"in",e=i.find("[data-loftocean-widget-item-id="+e+"]"),e=-1!==["radio","checkbox"].indexOf(e.first().attr("type"))?e.filter(":checked").length?e.filter(":checked").val():"":e.val();return"in"===n?-1!==t.value.indexOf(e):-1===t.value.indexOf(e)}function u(n,e,a){p.each(e,function(e,t){var i=n.find("[data-loftocean-widget-item-id="+t+"]");i.length&&a[t]&&(i=i.closest(".item-wrapper"),r(a[t],n)?i.show():i.hide())})}var h,g,f,c,l;window.wp=window.wp||{},wp.loftOceanWidgets=(h=!1,g=loftoceanWidgetJSON.dependency||{},f=loftoceanWidgetJSON.JSON||{},c=loftoceanWidgetJSON.widgets||[],l=[],void p(document).on("widget-added",e).on("widget-synced widget-updated",function(e,t){var i;"widgets"===window.pagenow&&(i=t.find("> .widget-inside > .form, > .widget-inside > form").find("> .id_base").val(),-1!==c.indexOf(i)&&o(t,i,!0))}).ready(function(){"widgets"===window.pagenow&&p(".widgets-holder-wrap:not(#available-widgets)").find("div.widget").one("click.toggle-widget-expanded",function(){e(new jQuery.Event("widget-added"),p(this))})}))}(jQuery);
