!function(y){"use strict";document.addEventListener("DOMContentLoaded",function(){var d,c,e,s,v,u,p,m,f,h,t=document.getElementById("availability-calendar"),b=y(".availability-editor"),l="on"==loftoceanRoomAvailability.roomSettings.priceByPeople,g=y(document),_=loftoceanRoomAvailability.i18nText;if(!b.length)return!1;var a=b.find(".date-picker");function i(e){return 9<e?e:"0"+e}a.length&&a.datepicker({dateFormat:"yy-mm-dd"}),d=b.find("#calendar_check_in"),c=b.find("#calendar_check_out"),e=b.find(".form-field.price-field"),a=b.find(".adult-child-price"),v=e.find("input"),u=a.find("#calendar_adult_price"),p=a.find("#calendar_child_price"),s=b.find("#calendar_status"),m=b.find("#calendar_room_number"),h=y(".calendar-loading"),l?(e.hide(),a.show()):(e.show(),a.hide()),(f=new FullCalendar.Calendar(t,{locale:loftoceanRoomAvailability.locale,timeZone:loftoceanRoomAvailability.timezone,headerToolbar:{left:"today",center:"title",right:"prev,next"},displayEventTime:!0,selectable:!0,fixedWeekCount:!1,eventClick:function({event:e}){var t=e.extendedProps,a=new Date(e.start.getFullYear(),e.start.getMonth(),e.start.getDate()),e=new Date(a);e.setDate(a.getDate()+1),e={start:a.getFullYear()+"-"+i(parseInt(a.getMonth(),10)+1)+"-"+i(a.getDate()),end:e.getFullYear()+"-"+i(parseInt(e.getMonth(),10)+1)+"-"+i(e.getDate())},d.val(e.start),c.val(e.end),v.val(t.price),u.val(t.adult_price),p.val(t.child_price),m.val(t.number),s.val(t.original_status)},events:function({start:e,end:t},a,n){e=e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate()),t=t.getFullYear()+"-"+i(t.getMonth()+1)+"-"+i(t.getDate());h.show(),y.ajax({url:wpApiSettings.root+"loftocean/v1/get_room_availability/"+(new Date).getTime(),data:{rid:loftoceanRoomAvailability.roomID,start:e,end:t},type:"POST",success:function(e){"object"==typeof e&&a(e),h.hide()},error:function(e){console.log(_.errorMessage),h.hide()}})},eventContent:function(e){var t,a,n,i=y("<div>",{class:"fc-content"});y("<div>",{class:"price"}),y("<div>",{class:"starttime"});return e.event.extendedProps.status&&(e.event.extendedProps.status,"unavailable"===e.event.extendedProps.original_status?(i.addClass("unavailable").removeClass("available"),i.html('<div class="not-available">'+_.unavailable+"</div>")):(i.addClass("available").removeClass("unavailable"),l?(void 0!==e.event.extendedProps.adult_price&&((t=y("<div>",{class:"price"})).html(_.adult+": "+e.event.extendedProps.adult_price),i.append(t)),void 0!==e.event.extendedProps.child_price&&((a=y("<div>",{class:"price"})).html(_.child+": "+e.event.extendedProps.child_price),i.append(a))):void 0!==e.event.extendedProps.price&&((a=y("<div>",{class:"price"})).html(_.base+": "+e.event.extendedProps.price),i.append(a)),void 0!==e.event.extendedProps.number&&((n=y("<div>",{class:"room-number"})).html(_.roomNumber+": "+e.event.extendedProps.number),i.append(n)),e.event.extendedProps.available_number,(n=y("<div>",{class:"room-number-left"})).html(_.leftNumber+": "+e.event.extendedProps.available_number),i.append(n))),{domNodes:[i.get(0)]}},dayMaxEvents:!0})).render(),y(document).on("render.loftocean.room.availability",function(e){f.trigger("_resize")}),b.on("click","input[type=submit]",function(e){e.preventDefault();var t,a=d.val(),n=c.val(),i=v.val(),l=u.val(),r=p.val(),o=s.val(),e=m.val();a&&n&&"object"==typeof(t={checkIn:a,checkOut:n,basePrice:i,adultPrice:l,childPrice:r,status:o,number:e})&&t.checkIn&&t.checkOut&&(e=[],new Date(t.checkIn).getTime()<new Date(t.checkOut).getTime()&&(e={checkin:t.checkIn,checkout:t.checkOut,price:t.basePrice,number:t.number,adult_price:t.adultPrice,child_price:t.childPrice,status:t.status},h.show(),y.ajax({url:wpApiSettings.root+"loftocean/v1/update_room_availability/"+(new Date).getTime(),data:{rid:loftoceanRoomAvailability.roomID,data:btoa(JSON.stringify(e))},method:"POST",success:function(e,t){"object"==typeof e&&e.updated?(f.refetchEvents(),b.find("input[type=text]").val(""),g.trigger("refresh.loftocean.bookingCalendar")):h.hide()},error:function(e){console.log(_.errorMessage),h.hide()}})))})})}(jQuery);
